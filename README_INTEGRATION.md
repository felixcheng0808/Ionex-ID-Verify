# ğŸ‰ æ•´åˆå®Œæˆï¼èº«åˆ†è­‰è¾¨è­˜ + è‡ªå‹•å¡«å¯«ç›£ç†æœå‹™ç¶²

## ğŸ“‹ æ•´åˆæ‘˜è¦

è‡ªå‹•å¡«å¯«ç›£ç†æœå‹™ç¶²è¡¨å–®çš„åŠŸèƒ½å·²æˆåŠŸæ•´åˆè‡³åŸæœ‰çš„èº«åˆ†è­‰è¾¨è­˜ç³»çµ±ä¸­ï¼

### âœ¨ ä¸»è¦æ”¹é€²

1. **ç„¡ç¸«æ•´åˆ** - åœ¨åŸæœ‰ API ä¸­æ–°å¢å¯é¸åƒæ•¸,ä¸å½±éŸ¿ç¾æœ‰ä½¿ç”¨æ–¹å¼
2. **å‘å¾Œå…¼å®¹** - é è¨­ä¸å•Ÿç”¨è‡ªå‹•å¡«å¯«,ä¿æŒåŸæœ‰è¡Œç‚º
3. **å½ˆæ€§ä½¿ç”¨** - åªéœ€åŠ ä¸Š `autoFillForm=true` å³å¯å•Ÿç”¨è‡ªå‹•å¡«å¯«
4. **å®Œæ•´æ–‡æª”** - æä¾›è©³ç´°çš„ä½¿ç”¨æŒ‡å—å’Œæ¸¬è©¦å·¥å…·

## ğŸš€ å¿«é€Ÿé–‹å§‹

### 1. å•Ÿå‹•ä¼ºæœå™¨

```bash
npm start
```

ä¼ºæœå™¨æœƒåœ¨ http://localhost:3000 å•Ÿå‹•

### 2. æ¸¬è©¦æ–¹å¼

#### æ–¹å¼ A: ä½¿ç”¨ç¶²é ä»‹é¢ (æ¨è–¦åˆæ¬¡ä½¿ç”¨)

é–‹å•Ÿç€è¦½å™¨è¨ªå•:
```
http://localhost:3000/test-auto-fill.html
```

é€™å€‹æ¸¬è©¦é é¢æä¾›:
- âœ“ ç›´è¦ºçš„åœ–å½¢åŒ–ç•Œé¢
- âœ“ æ‹–æ›³ä¸Šå‚³æ”¯æ´
- âœ“ å³æ™‚é è¦½
- âœ“ é¸é …é–‹é—œ (å•Ÿç”¨è‡ªå‹•å¡«å¯«ã€ä¿æŒç€è¦½å™¨é–‹å•Ÿ)
- âœ“ å®Œæ•´çš„çµæœé¡¯ç¤º

#### æ–¹å¼ B: ä½¿ç”¨ cURL å‘½ä»¤

**åªè¾¨è­˜ (é è¨­è¡Œç‚º)**
```bash
curl -X POST http://localhost:3000/api/verify/upload \
  -F "image=@/path/to/id-card.jpg"
```

**è¾¨è­˜ + è‡ªå‹•å¡«å¯«**
```bash
curl -X POST http://localhost:3000/api/verify/upload \
  -F "image=@/path/to/id-card.jpg" \
  -F "autoFillForm=true" \
  -F "keepBrowserAlive=true"
```

#### æ–¹å¼ C: ä½¿ç”¨æ¸¬è©¦è…³æœ¬

```bash
# æ¸¬è©¦æ—¥æœŸæ ¼å¼è½‰æ›
node test_date_format.js

# æ¸¬è©¦è‡ªå‹•å¡«å¯« (éœ€ä¿®æ”¹æ¸¬è©¦è³‡æ–™)
node test_auto_fill.js
```

## ğŸ“ ä½¿ç”¨èªªæ˜

### API åƒæ•¸

| åƒæ•¸ | é¡å‹ | é è¨­å€¼ | èªªæ˜ |
|------|------|--------|------|
| `autoFillForm` | boolean | false | æ˜¯å¦å•Ÿç”¨è‡ªå‹•å¡«å¯«ç›£ç†æœå‹™ç¶² |
| `keepBrowserAlive` | boolean | true | è‡ªå‹•å¡«å¯«æ™‚æ˜¯å¦ä¿æŒç€è¦½å™¨é–‹å•Ÿ |

### API ç«¯é»

| ç«¯é» | èªªæ˜ | æ¨è–¦ |
|------|------|------|
| `POST /api/verify/url` | é€é URL è¾¨è­˜ (å¯é¸è‡ªå‹•å¡«å¯«) | â­ æ¨è–¦ |
| `POST /api/verify/upload` | é€éä¸Šå‚³è¾¨è­˜ (å¯é¸è‡ªå‹•å¡«å¯«) | â­ æ¨è–¦ |
| `POST /api/verify-and-fill/url` | å¼·åˆ¶è‡ªå‹•å¡«å¯« (å‘å¾Œå…¼å®¹) | èˆŠç‰ˆ |
| `POST /api/verify-and-fill/upload` | å¼·åˆ¶è‡ªå‹•å¡«å¯« (å‘å¾Œå…¼å®¹) | èˆŠç‰ˆ |

## ğŸ“– å®Œæ•´æ–‡æª”

- **INTEGRATION_GUIDE.md** - æ•´åˆä½¿ç”¨æŒ‡å— (è©³ç´°çš„ API èªªæ˜å’Œç¯„ä¾‹)
- **AUTO_FILL_README.md** - è‡ªå‹•å¡«å¯«åŠŸèƒ½æŠ€è¡“æ–‡æª”
- **test-auto-fill.html** - ç¶²é æ¸¬è©¦å·¥å…·
- **test_date_format.js** - æ—¥æœŸè½‰æ›æ¸¬è©¦
- **test_auto_fill.js** - è‡ªå‹•å¡«å¯«æ¸¬è©¦

## ğŸ¯ ä½¿ç”¨ç¯„ä¾‹

### JavaScript (å‰ç«¯)

```javascript
// ä¸Šå‚³ä¸¦è¾¨è­˜
async function uploadAndVerify(file, autoFill = false) {
  const formData = new FormData();
  formData.append('image', file);

  if (autoFill) {
    formData.append('autoFillForm', 'true');
    formData.append('keepBrowserAlive', 'true');
  }

  const response = await fetch('/api/verify/upload', {
    method: 'POST',
    body: formData
  });

  return await response.json();
}

// ä½¿ç”¨
const result = await uploadAndVerify(file, true);
console.log('è¾¨è­˜çµæœ:', result.data);
if (result.automation) {
  console.log('å·²è‡ªå‹•å¡«å¯«è¡¨å–®');
}
```

### Python

```python
import requests

# è¾¨è­˜ä¸¦è‡ªå‹•å¡«å¯«
def verify_and_fill(image_path):
    with open(image_path, 'rb') as f:
        response = requests.post(
            'http://localhost:3000/api/verify/upload',
            files={'image': f},
            data={
                'autoFillForm': 'true',
                'keepBrowserAlive': 'true'
            }
        )
    return response.json()
```

## ğŸ“Š å›æ‡‰æ ¼å¼

### å•Ÿç”¨è‡ªå‹•å¡«å¯«æ™‚çš„å›æ‡‰

```json
{
  "success": true,
  "message": "è¾¨è­˜æˆåŠŸï¼Œå·²è‡ªå‹•å¡«å¯«ç›£ç†æœå‹™ç¶²è¡¨å–®",
  "data": {
    "idNumber": "A123456789",
    "name": "ç‹å°æ˜",
    "gender": "ç”·",
    "birthDate": "74å¹´01æœˆ01æ—¥",
    "issueDate": "99.01.01",
    "issueLocation": "å°åŒ—å¸‚"
  },
  "validation": {
    "isComplete": true,
    "missingFields": [],
    "warnings": []
  },
  "confidence": 0.95,
  "automation": {
    "success": true,
    "message": "è¡¨å–®å·²è‡ªå‹•å¡«å¯«å®Œæˆï¼Œè«‹æ‰‹å‹•è¼¸å…¥é©—è­‰ç¢¼ä¸¦æäº¤è¡¨å–®ã€‚ç€è¦½å™¨å°‡ä¿æŒé–‹å•Ÿç‹€æ…‹ã€‚",
    "data": {
      "idNumber": "A123456789",
      "birthDate": "74å¹´01æœˆ01æ—¥",
      "birthDateFormatted": "0740101",
      "url": "https://www.mvdis.gov.tw/m3-emv-vil/vil/driverLicensePenalty#gsc.tab=0",
      "pageReady": true,
      "formFilled": true,
      "waitingForCaptcha": true
    }
  }
}
```

## âš™ï¸ å·¥ä½œæµç¨‹

```
ç”¨æˆ¶ä¸Šå‚³èº«åˆ†è­‰åœ–ç‰‡
    â†“
OCR è¾¨è­˜èº«åˆ†è­‰è³‡è¨Š
    â†“
è§£æå§“åã€èº«åˆ†è­‰å­—è™Ÿã€ç”Ÿæ—¥ç­‰
    â†“
å¦‚æœ autoFillForm=true ä¸”è³‡æ–™å®Œæ•´:
    â”œâ”€ å°‡ç”Ÿæ—¥è½‰æ›ç‚º YYYMMDD æ ¼å¼
    â”œâ”€ å•Ÿå‹• Puppeteer ç€è¦½å™¨
    â”œâ”€ é–‹å•Ÿç›£ç†æœå‹™ç¶²
    â”œâ”€ è‡ªå‹•å¡«å¯«èº«åˆ†è­‰å­—è™Ÿå’Œç”Ÿæ—¥
    â””â”€ ç­‰å¾…ä½¿ç”¨è€…è¼¸å…¥é©—è­‰ç¢¼
    â†“
è¿”å›è¾¨è­˜çµæœ + è‡ªå‹•å¡«å¯«ç‹€æ…‹
```

## ğŸ”§ æŠ€è¡“ç´°ç¯€

### æ–°å¢/ä¿®æ”¹çš„æª”æ¡ˆ

**æ–°å¢:**
- `src/services/webAutomationService.js` - ç€è¦½å™¨è‡ªå‹•åŒ–æœå‹™
- `public/test-auto-fill.html` - ç¶²é æ¸¬è©¦å·¥å…·
- `test_date_format.js` - æ—¥æœŸè½‰æ›æ¸¬è©¦
- `test_auto_fill.js` - è‡ªå‹•å¡«å¯«æ¸¬è©¦
- `INTEGRATION_GUIDE.md` - æ•´åˆæŒ‡å—
- `AUTO_FILL_README.md` - åŠŸèƒ½æ–‡æª”
- `README_INTEGRATION.md` - æ•´åˆæ‘˜è¦ (æœ¬æ–‡ä»¶)

**ä¿®æ”¹:**
- `src/services/parserService.js` - æ–°å¢æ—¥æœŸè½‰æ›å‡½æ•¸
  - `convertToMVDISFormat()` - è½‰æ›ç‚º YYYMMDD æ ¼å¼
  - `validateMVDISDate()` - é©—è­‰æ—¥æœŸæ ¼å¼
- `src/controllers/idCardController.js` - æ•´åˆè‡ªå‹•å¡«å¯«é‚è¼¯
  - `verifyByUrl()` - æ–°å¢ autoFillForm åƒæ•¸
  - `verifyByUpload()` - æ–°å¢ autoFillForm åƒæ•¸
- `src/app.js` - æ›´æ–°è·¯ç”±å’Œæ–‡æª”
- `package.json` - æ–°å¢ Puppeteer ä¾è³´

### æ—¥æœŸæ ¼å¼è½‰æ›

ç³»çµ±æ”¯æ´å¤šç¨®æ°‘åœ‹å¹´æ ¼å¼:

| è¼¸å…¥æ ¼å¼ | è¼¸å‡ºæ ¼å¼ | ç¯„ä¾‹ |
|---------|---------|------|
| 74å¹´1æœˆ1æ—¥ | 0740101 | æ°‘åœ‹74å¹´1æœˆ1æ—¥ |
| 74å¹´01æœˆ01æ—¥ | 0740101 | å·²è£œ0æ ¼å¼ |
| 74.1.1 | 0740101 | é»è™Ÿåˆ†éš” |
| 5å¹´5æœˆ5æ—¥ | 0050505 | å€‹ä½æ•¸å¹´ä»½ |
| 100å¹´12æœˆ31æ—¥ | 1001231 | ä¸‰ä½æ•¸å¹´ä»½ |

## âš ï¸ æ³¨æ„äº‹é …

1. **é©—è­‰ç¢¼è™•ç†**
   - ç›£ç†æœå‹™ç¶²æœ‰é©—è­‰ç¢¼ä¿è­·
   - éœ€è¦ä½¿ç”¨è€…æ‰‹å‹•è¼¸å…¥
   - ç€è¦½å™¨æœƒä¿æŒé–‹å•Ÿç­‰å¾…ä½¿ç”¨è€…æ“ä½œ

2. **è³‡æ–™å®Œæ•´æ€§**
   - åªæœ‰æˆåŠŸè¾¨è­˜å‡ºèº«åˆ†è­‰å­—è™Ÿå’Œç”Ÿæ—¥æ™‚æ‰æœƒåŸ·è¡Œè‡ªå‹•å¡«å¯«
   - å¦‚æœè³‡æ–™ä¸å®Œæ•´,åªè¿”å›è¾¨è­˜çµæœ

3. **ç€è¦½å™¨è³‡æº**
   - æ¯æ¬¡è‡ªå‹•å¡«å¯«æœƒé–‹å•Ÿæ–°çš„ç€è¦½å™¨è¦–çª—
   - å®Œæˆå¾Œè«‹é—œé–‰ç€è¦½å™¨
   - ä¼ºæœå™¨é—œé–‰æ™‚æœƒè‡ªå‹•æ¸…ç†

4. **ä¸¦ç™¼é™åˆ¶**
   - å¤§é‡ä¸¦ç™¼å¯èƒ½æ¶ˆè€—è¼ƒå¤šè³‡æº
   - å»ºè­°æ ¹æ“šä¼ºæœå™¨é…ç½®é™åˆ¶ä¸¦ç™¼æ•¸

## ğŸ› æ•…éšœæ’é™¤

### å•é¡Œ: è‡ªå‹•å¡«å¯«æ²’æœ‰åŸ·è¡Œ

**æª¢æŸ¥:**
1. ç¢ºèª `autoFillForm` æ˜¯å¦è¨­ç‚º `true`
2. æª¢æŸ¥ OCR æ˜¯å¦æˆåŠŸè¾¨è­˜èº«åˆ†è­‰å­—è™Ÿå’Œç”Ÿæ—¥
3. æŸ¥çœ‹ä¼ºæœå™¨æ—¥èªŒä¸­çš„éŒ¯èª¤è¨Šæ¯

### å•é¡Œ: ç€è¦½å™¨ç„¡æ³•é–‹å•Ÿ

**å¯èƒ½åŸå› :**
- ä¼ºæœå™¨ç’°å¢ƒä¸æ”¯æ´åœ–å½¢ç•Œé¢
- Puppeteer æœªæ­£ç¢ºå®‰è£

**è§£æ±º:**
```bash
npm install puppeteer
```

### å•é¡Œ: æ—¥æœŸæ ¼å¼éŒ¯èª¤

**è§£æ±º:**
```bash
# æ¸¬è©¦æ—¥æœŸè½‰æ›
node test_date_format.js
```

## ğŸ“ æ¸¬è©¦èˆ‡é©—è­‰

### æ¸¬è©¦æ¸…å–®

- [x] æ—¥æœŸæ ¼å¼è½‰æ›åŠŸèƒ½
- [x] ç€è¦½å™¨è‡ªå‹•åŒ–åŠŸèƒ½
- [x] API åƒæ•¸é©—è­‰
- [x] éŒ¯èª¤è™•ç†
- [x] å‘å¾Œå…¼å®¹æ€§
- [x] ç¶²é æ¸¬è©¦å·¥å…·
- [x] æ–‡æª”å®Œæ•´æ€§

### å»ºè­°æ¸¬è©¦æµç¨‹

1. **åŠŸèƒ½æ¸¬è©¦**
   ```bash
   # å•Ÿå‹•ä¼ºæœå™¨
   npm start

   # é–‹å•Ÿæ¸¬è©¦é é¢
   # http://localhost:3000/test-auto-fill.html

   # ä¸Šå‚³èº«åˆ†è­‰åœ–ç‰‡æ¸¬è©¦
   ```

2. **æ—¥æœŸè½‰æ›æ¸¬è©¦**
   ```bash
   node test_date_format.js
   ```

3. **API æ¸¬è©¦**
   ```bash
   # æ¸¬è©¦åªè¾¨è­˜
   curl -X POST http://localhost:3000/api/verify/upload \
     -F "image=@test.jpg"

   # æ¸¬è©¦è¾¨è­˜+è‡ªå‹•å¡«å¯«
   curl -X POST http://localhost:3000/api/verify/upload \
     -F "image=@test.jpg" \
     -F "autoFillForm=true"
   ```

## ğŸ“ å­¸ç¿’è³‡æº

- **Puppeteer æ–‡æª”**: https://pptr.dev/
- **ç›£ç†æœå‹™ç¶²**: https://www.mvdis.gov.tw/
- **Express.js æ–‡æª”**: https://expressjs.com/

## ğŸ“„ æˆæ¬Š

æœ¬å°ˆæ¡ˆç”± Ionex é–‹ç™¼ç¶­è­·

---

## ğŸŠ ç¸½çµ

è‡ªå‹•å¡«å¯«åŠŸèƒ½å·²å®Œç¾æ•´åˆè‡³èº«åˆ†è­‰è¾¨è­˜ç³»çµ±!

**ä¸»è¦å„ªå‹¢:**
- âœ“ ç„¡ç¸«æ•´åˆ,ä¸ç ´å£ç¾æœ‰åŠŸèƒ½
- âœ“ å‘å¾Œå…¼å®¹,é è¨­è¡Œç‚ºä¸è®Š
- âœ“ å½ˆæ€§ä½¿ç”¨,å¯é¸æ“‡å•Ÿç”¨
- âœ“ å®Œæ•´æ¸¬è©¦,æä¾›å¤šç¨®æ¸¬è©¦å·¥å…·
- âœ“ è©³ç´°æ–‡æª”,æ˜“æ–¼ç†è§£å’Œä½¿ç”¨

**æ¨è–¦ä½¿ç”¨æ–¹å¼:**
1. ä½¿ç”¨åŸæœ‰çš„ `/api/verify/upload` ç«¯é»
2. ç•¶éœ€è¦è‡ªå‹•å¡«å¯«æ™‚,åŠ ä¸Š `autoFillForm=true` åƒæ•¸
3. å»ºè­°ä¿æŒ `keepBrowserAlive=true` ä»¥ä¾¿æ‰‹å‹•è¼¸å…¥é©—è­‰ç¢¼

é–‹å§‹ä½¿ç”¨å§! ğŸš€
